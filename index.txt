<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prism Loop — Test Page</title>
  <style>
    :root{
      --bg:#0f1724;
      --accent1:#7dd3fc;
      --accent2:#a78bfa;
      --card:#0b1220;
      --glass: rgba(255,255,255,0.04);
      --mono: #cbd5e1;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{
      background:
        radial-gradient(600px 300px at 10% 10%, rgba(167,139,250,0.08), transparent 10%),
        radial-gradient(500px 250px at 90% 90%, rgba(125,211,252,0.06), transparent 10%),
        var(--bg);
      color:var(--mono);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:32px;
      box-sizing:border-box;
    }
    .card{
      width:min(980px,96vw);
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:28px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.6);
      display:grid;
      grid-template-columns: 1fr 340px;
      gap:20px;
      align-items:start;
    }
    h1{margin:0 0 6px 0;font-size:28px;letter-spacing:-0.02em}
    p.lead{margin:0 0 18px 0;color:#9fb0c8}
    .meta{font-size:13px;color:#8aa0b8;margin-bottom:12px}
    .host{font-weight:600;color:var(--accent1)}
    .status{
      display:inline-block;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,var(--accent1),var(--accent2));
      color:#021025;font-weight:700;margin-left:8px;font-size:13px;
    }

    /* visualizer */
    canvas{width:100%;height:160px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));display:block}

    /* controls */
    .controls{display:flex;gap:10px;flex-wrap:wrap}
    button{
      background:var(--glass);border:1px solid rgba(255,255,255,0.03);color:var(--mono);
      padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600;
    }
    button.primary{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#021025;border:none}
    .samples{display:flex;flex-direction:column;gap:8px}
    .sample{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;cursor:pointer;border:1px dashed rgba(255,255,255,0.02)}
    .sample:hover{transform:translateY(-3px);transition:transform .15s}

    footer{grid-column:1/-1;margin-top:12px;color:#7f98ad;font-size:13px}
    @media (max-width:880px){
      .card{grid-template-columns:1fr; padding:18px}
      canvas{height:120px}
    }
  </style>
</head>
<body>
  <main class="card" role="main">
    <section>
      <h1>Prism Loop — Test Page</h1>
      <p class="lead">A tiny verification page: shows the site host, live clock, and a simple audio visualizer you can play.</p>

      <div class="meta">
        Host: <span id="host" class="host">loading…</span>
        <span id="liveStatus" class="status">Checking</span>
      </div>

      <canvas id="viz" width="800" height="160" aria-hidden="true"></canvas>

      <div style="margin-top:12px" class="controls">
        <button id="toggleTone" class="primary">Play Tone</button>
        <button id="stopAll">Stop</button>
        <div style="margin-left:auto;color:#9fb0c8" id="clock">--:--:--</div>
      </div>

      <p style="margin-top:14px;color:#9fb0c8">Open the browser console to see a small runtime log confirming the audio context and visualizer are active.</p>
    </section>

    <aside>
      <div style="margin-bottom:12px;font-weight:700">Mouse‑over samples</div>
      <div class="samples" id="samples">
        <div class="sample" data-freq="440">A4 — 440 Hz (hover)</div>
        <div class="sample" data-freq="523.25">C5 — 523 Hz (hover)</div>
        <div class="sample" data-freq="659.25">E5 — 659 Hz (hover)</div>
        <div class="sample" data-freq="880">A5 — 880 Hz (hover)</div>
      </div>

      <div style="margin-top:18px;font-size:13px;color:#8aa0b8">
        Quick checks:
        <ul style="padding-left:18px;margin:8px 0 0 0">
          <li>Hostname displays automatically</li>
          <li>Clock updates every second</li>
          <li>Play Tone toggles an oscillator and visualizer</li>
          <li>Hover samples play short tones</li>
        </ul>
      </div>
    </aside>

    <footer>Built for testing GitHub Pages deployment — if you see the host and the visualizer runs, your site is live.</footer>
  </main>

  <script>
    // show hostname and set status
    document.getElementById('host').textContent = location.hostname || 'unknown';
    document.getElementById('liveStatus').textContent = 'Live';

    // clock
    function updateClock(){
      const el = document.getElementById('clock');
      const now = new Date();
      el.textContent = now.toLocaleTimeString();
    }
    updateClock();
    setInterval(updateClock,1000);

    // Audio + visualizer setup
    let audioCtx = null;
    let analyser = null;
    let osc = null;
    let gain = null;
    let rafId = null;

    const canvas = document.getElementById('viz');
    const ctx = canvas.getContext('2d');

    function ensureAudio(){
      if(!audioCtx){
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioCtx.createAnalyser();
        analyser.fftSize = 256;
        gain = audioCtx.createGain();
        gain.gain.value = 0.12;
        analyser.connect(gain);
        gain.connect(audioCtx.destination);
        console.log('AudioContext created', audioCtx.state);
      }
    }

    function startOsc(freq=220){
      ensureAudio();
      if(osc) return;
      osc = audioCtx.createOscillator();
      osc.type = 'sine';
      osc.frequency.value = freq;
      osc.connect(analyser);
      osc.start();
      drawVisualizer();
      console.log('Oscillator started at', freq);
    }

    function stopOsc(){
      if(osc){
        try{osc.stop()}catch(e){}
        osc.disconnect();
        osc = null;
      }
      if(rafId){ cancelAnimationFrame(rafId); rafId = null; clearCanvas(); }
      console.log('Oscillator stopped');
    }

    function clearCanvas(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = 'rgba(2,6,23,0.6)';
      ctx.fillRect(0,0,canvas.width,canvas.height);
    }

    function drawVisualizer(){
      if(!analyser) return;
      const bufferLength = analyser.frequencyBinCount;
      const data = new Uint8Array(bufferLength);
      const w = canvas.width;
      const h = canvas.height;
      function draw(){
        analyser.getByteFrequencyData(data);
        ctx.clearRect(0,0,w,h);
        // background prism gradient
        const g = ctx.createLinearGradient(0,0,w,h);
        g.addColorStop(0,'rgba(167,139,250,0.06)');
        g.addColorStop(0.5,'rgba(125,211,252,0.04)');
        g.addColorStop(1,'rgba(255,255,255,0.01)');
        ctx.fillStyle = g;
        ctx.fillRect(0,0,w,h);

        // bars
        const barWidth = (w / bufferLength) * 1.6;
        let x = 0;
        for(let i=0;i<bufferLength;i++){
          const v = data[i] / 255;
          const barHeight = v * h * 1.1;
          const hue = 200 + (i / bufferLength) * 120;
          ctx.fillStyle = `hsl(${hue} 80% ${30 + v*40}%)`;
          ctx.fillRect(x, h - barHeight, barWidth, barHeight);
          x += barWidth + 1;
        }
        rafId = requestAnimationFrame(draw);
      }
      draw();
    }

    // Play/Stop button
    const toggleBtn = document.getElementById('toggleTone');
    toggleBtn.addEventListener('click', () => {
      if(!audioCtx) ensureAudio();
      if(!osc){
        // resume context if suspended (user gesture)
        if(audioCtx.state === 'suspended') audioCtx.resume();
        startOsc(220);
        toggleBtn.textContent = 'Stop Tone';
      } else {
        stopOsc();
        toggleBtn.textContent = 'Play Tone';
      }
    });

    document.getElementById('stopAll').addEventListener('click', () => {
      stopOsc();
      toggleBtn.textContent = 'Play Tone';
    });

    // hover samples
    document.querySelectorAll('.sample').forEach(el=>{
      let hoverOsc = null;
      el.addEventListener('mouseenter', () => {
        const f = parseFloat(el.dataset.freq) || 440;
        ensureAudio();
        if(audioCtx.state === 'suspended') audioCtx.resume();
        hoverOsc = audioCtx.createOscillator();
        hoverOsc.type = 'triangle';
        hoverOsc.frequency.value = f;
        hoverOsc.connect(analyser);
        hoverOsc.start();
      });
      el.addEventListener('mouseleave', () => {
        if(hoverOsc){
          try{hoverOsc.stop()}catch(e){}
          hoverOsc.disconnect();
          hoverOsc = null;
        }
      });
      // also allow click to play short beep
      el.addEventListener('click', () => {
        ensureAudio();
        const b = audioCtx.createOscillator();
        b.type = 'square';
        b.frequency.value = parseFloat(el.dataset.freq) || 440;
        const g = audioCtx.createGain();
        g.gain.value = 0.0001;
        b.connect(analyser);
        b.start();
        // quick envelope
        const now = audioCtx.currentTime;
        g.gain.setValueAtTime(0.0001, now);
        g.gain.exponentialRampToValueAtTime(0.12, now + 0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, now + 0.25);
        setTimeout(()=>{ try{b.stop()}catch(e){} b.disconnect(); }, 300);
      });
    });

    // resize canvas to device pixel ratio
    function resizeCanvas(){
      const ratio = window.devicePixelRatio || 1;
      canvas.width = Math.floor(canvas.clientWidth * ratio);
      canvas.height = Math.floor(canvas.clientHeight * ratio);
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
    clearCanvas();

    console.log('Prism Loop test page loaded. Host:', location.hostname);
  </script>
</body>
</html>
